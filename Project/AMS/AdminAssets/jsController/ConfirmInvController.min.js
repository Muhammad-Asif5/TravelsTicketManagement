$("#reservation").daterangepicker(); var table, TotalInvoiceNoWithArray = [], newRollNo = [], AmountReceiveObject = []; function viewReport() { var e = $("#reservation").val(), t = e.substring(0, 10), a = e.substring(13), e = $("#Cust_Code").val(); $("#myTable").DataTable().destroy(), $("table tbody").empty(), $.ajax({ type: "POST", url: "/GenerateInvoice/GetAllConfirmInvoiceByDate", data: { Dfrom: t, Dto: a, CustCode: e }, beforeSend: function () { swal({ title: " ", text: "Please Wait", imageUrl: "/AdminAssets/Images/ajax-Load.gif", showCancelButton: !1, showConfirmButton: !1 }) }, success: OnSuccess, failure: function (e) { alert(e.d) }, error: function (e) { alert(e.d) } }), $("#myTable tfoot th").each(function (e) { var t = $(this).text(); "Paid" != t && "Ticket Number" != t && "Invoice Amount" != t && "" != t && ($(this).html('<input style="width:150px;" type="text" class="form-control" placeholder="Search ' + t + '" />'), $("input", this).on("keyup change clear", function () { table.column(e).search() !== this.value && table.column(e).search(this.value).draw() })) }) } function myDatatable() { Paid = [], TotalInvoiceNoWithArray = [], $.ajax({ type: "POST", url: "/GenerateInvoice/GetAllConfirmReceiveable", data: "{}", contentType: "application/json; charset=utf-8", dataType: "json", beforeSend: function () { swal({ title: " ", text: "Please Wait", imageUrl: "/AdminAssets/Images/ajax-Load.gif", showCancelButton: !1, showConfirmButton: !1 }) }, success: OnSuccess, failure: function (e) { alert(e.d) }, error: function (e) { alert(e.d) } }), $("#myTable tfoot th").each(function (e) { var t = $(this).text(); "Paid" != t && "Ticket Number" != t && "Invoice Amount" != t && "" != t && ($(this).html('<input style="width:150px;" type="text" class="form-control" placeholder="Search ' + t + '" />'), $("input", this).on("keyup change clear", function () { table.column(e).search() !== this.value && table.column(e).search(this.value).draw() })) }) } function OnSuccess(e) { var t; $("#checkAll").prop("checked", !1), 1 == e.success ? (setTimeout(function () { swal.close() }, 1500), table = $("#myTable").DataTable({ lengthMenu: [[20, 50, 100, 150], [20, 50, 100, 150]], orderCellsTop: !0, fixedHeader: !0, scrollCollapse: !0, scrollX: !0, select: !0, scrollY: "50vh", processing: !0, data: e.RAmount, columns: [{ data: "Invoice_Number" }, { data: "Paid", render: function (e, t, a, n) { return 0 == a.Paid || null == a.Paid ? '<input value="' + a.Invoice_Amount + '" style="width:150px;" tabindex="' + (n.row + 1) + '" id="ObtainedMarks' + a.Invoice_Number + '" type="number" name="name" class="form-control" />' : '<input value="' + a.Paid + '" style="width:150px;" tabindex="' + (n.row + 1) + '" id="ObtainedMarks' + a.Invoice_Number + '" type="number" name="name" class="form-control" />' } }, { data: "Invoice_Amount" }, { data: "Balance" }, { data: "Ticket_Number" }, { data: "Description" }, { data: "ReceivePay_Status", render: function (e, t, a, n) { return "1" == a.ReceivePay_Status ? "<label class='badge bg-success'>Paid</label>" : "<label class='badge bg-danger'>Not Paid</label>" } }, { data: "Invoice_Number", orderable: !1, render: function (e, t, a, n) { return '<input id="' + a.Invoice_Number + '" onclick="toggle(this);"  type="checkbox" class="RegisterChkbox" name="RegisterChkbox1" />' } }], fnCreatedRow: function (e, t, a) { t = t.Invoice_Number; $(e).attr("id", t) }, footerCallback: function (e, t, a, n, o) { function i(e) { return "string" == typeof e ? +e.replace(/[\$,]/g, "") : "number" == typeof e ? e : 0 } var r = this.api(); amount = r.column(2, { page: "current" }).data().reduce(function (e, t) { return i(e) + i(t) }, 0), $(r.column(2).footer()).html("$ " + amount.toFixed(2)), balance = r.column(3, { page: "current" }).data().reduce(function (e, t) { return i(e) + i(t) }, 0), $(r.column(3).footer()).html("$ " + balance.toFixed(2)) }, language: { search: "", lengthMenu: "Select _MENU_ ", zeroRecords: "No <b>Confirm Receive Invoice</b> Data Found", infoEmpty: "No Records Available", infoFiltered: "(filtered from _MAX_ total records)" } }), $(".dataTables_filter input").attr("placeholder", "Search Confirm Receive Invoice"), $(".dataTables_filter input").addClass("form-control")) : ($("#myTable").DataTable({ bLengthChange: !1, orderCellsTop: !0, fixedHeader: !0, scrollCollapse: !0, searching: !1, scrollX: !0, scrollY: "50vh", processing: !0, language: { search: "", lengthMenu: "Select _MENU_ ", zeroRecords: "No <b>Confirm Receive Invoice</b> Data Found", infoEmpty: "No Records Available", infoFiltered: "(filtered from _MAX_ total records)" } }), t = $("#reservation").val(), swal("INFO!", e.message + " for " + t, "info")) } function CalculateObtainedMarks(e, t) { var a = t.substring(13, 20); CombineMarksvalue.push(t), TotalInvoiceNoWithArray.push(a) } function toggle(e) { var t, a = e.id; 1 == e.checked ? (t = 0, $(".RegisterChkbox").each(function () { this.checked || (t = 1) }), 0 == t && $("#checkAll").prop("checked", !0), e = $("#ObtainedMarks" + a).val(), AmountReceiveObject.push({ ID: a, obtainerMarks: e })) : ($("#checkAll").prop("checked", !1), AmountReceiveObject = AmountReceiveObject.filter(function (e) { return e.ID !== a })) } function getUniqueListBy(e, t) { return [...new Map(e.map(e => [e[t], e])).values()] } $(document).ready(function () { myDatatable() }), $("#checkAll").change(function () { this.checked ? $(".RegisterChkbox").each(function () { this.checked = !0; var e = this.id, t = $("#ObtainedMarks" + e).val(); AmountReceiveObject.push({ ID: e, obtainerMarks: t }) }) : $(".RegisterChkbox").each(function () { this.checked = !1; var t = this.id; AmountReceiveObject = AmountReceiveObject.filter(function (e) { return e.ID !== t }) }) }); var AmountPaid = []; function saveConfirmInvoice() { if (TotalInvoiceNoWithArray = [], 0 < AmountReceiveObject.length) { for (var e = getUniqueListBy(AmountReceiveObject, "ID"), t = 0; t < e.length; t++)TotalInvoiceNoWithArray.push(e[t].ID), "" == e[t].obtainerMarks ? AmountPaid.push(null) : AmountPaid.push(e[t].obtainerMarks); UpdateConfirmInvoice(TotalInvoiceNoWithArray, AmountPaid) } else $(".ui-pnotify").remove(), new PNotify({ title: "INFO!", text: "Please Check at least one", type: "info", animation: "slide", delay: 3e3, top: "500px", min_height: "16px", animate_speed: 400, text_escape: !0, styling: "bootstrap3" }) } function UpdateConfirmInvoice(e, t) { $.ajax({ type: "POST", url: "/GenerateInvoice/SaveConfirmReceiveable", data: { InvNo: e, Paid: t }, success: function (e) { 1 == e.success ? ($("#myTable").DataTable().destroy(), $("table tbody").empty(), myDatatable(), $(".ui-pnotify").remove(), new PNotify({ title: "SUCCESS!", text: e.message, type: "success", animation: "slide", delay: 3e3, top: "500px", min_height: "16px", animate_speed: 400, text_escape: !0, styling: "bootstrap3" })) : $("table tbody").append("<tr><td style='text-align:center; font-weight:500' colspan='9'>No Data Found, Invoice has already been Received</td></tr > ") } }) } function ArrNoDupe(e) { for (var t = {}, a = 0; a < e.length; a++)t[e[a]] = !0; var n, o = []; for (n in t) o.push(n); return o }